%h2
  機種別部門
  - if @twitter_account && @twitter_account.user.present?
    = link_to 'スコアを編集する', edit_game_path, class: 'btn btn-primary'

%ul.nav.nav-tabs
  - Game.all.each_with_index do |game, index|
    %li{ class: index == 0 ? 'active' : '' }
      = link_to game.title, "#game#{game.id}", :'data-toggle' => 'tab'
  %li= link_to '曲目', "#game#{0}", :'data-toggle' => 'tab'

.tab-content
  - Game.all.each_with_index do |game, index|
    .tab-pane{ class: index == 0 ? 'active' : '', id: "game#{game.id}" }
      %table.table.table-bordered.table-striped
        %thead
          %tr
            %td 順位
            %td 名前
            %td サークル
            %td 合計スコア
            - game.game_musics.each do |music|
              %td= music.title
        %tbody
          - last_score = 0
          - last_rank = 1
          - game.game_totals.sort_by(&:total_score).reverse.each_with_index do |game_total, index|
            - unless last_score == game_total.total_score
              - last_score = game_total.total_score
              - last_rank = index + 1
            %tr
              %td= last_rank
              %td= game_total.user.name
              - if game_total.user.circle_id == 0
                %td= '無所属'
              - else
                %td= game_total.user.circle.name
              %td= game_total.total_score
              - game.game_musics.each do |music|
                %td= Game::Score.where(game_music_id: music.id, game_total_id: game_total.id).first.score
  #game0.tab-pane
    %table.table.table-bordered.table-striped
      %thead
        %tr
          %td 機種
          %td{ colspan: 2 } 課題曲1
          %td{ colspan: 2 } 課題曲2
          %td{ colspan: 2 } 課題曲3
      %tbody
        - Game.all.each do |game|
          %tr
            %td= game.title
            - game.game_musics.each do |music|
              %td= music.difficulty
              %td= music.title
